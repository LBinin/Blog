# æ·±å…¥ç†è§£ DNS

## ç®€ä»‹
DNSï¼ˆDomain Name Systemï¼‰åŸŸåç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªå°†åŸŸåå’Œ IP åœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼ŒæŠŠå®¹æ˜“è®°å¿†çš„ä¸»æœºåè½¬æ¢æˆä¸»æœº IP åœ°å€ã€‚

DNSä½¿ç”¨ TCP å’Œ UDP ç«¯å£ 53ã€‚å½“å‰ï¼Œå¯¹äºæ¯ä¸€çº§åŸŸåé•¿åº¦çš„é™åˆ¶æ˜¯ 63 ä¸ªå­—ç¬¦ï¼ŒåŸŸåæ€»é•¿åº¦åˆ™ä¸èƒ½è¶…è¿‡ 253 ä¸ªå­—ç¬¦ã€‚

## ä¸“æœ‰åè¯

- **FQDN**ï¼šå®Œæ•´åˆæ³•åŸŸåï¼Œä¹Ÿå°±æ˜¯æ ¹åŸŸï¼ˆç»å¯¹åŸŸåï¼‰
- **NS**ï¼šæƒå¨åŸŸåæœåŠ¡å™¨
- **é¡¶çº§åŸŸ**ï¼šç”¨æ¥æŒ‡ç¤ºæŸä¸ªå›½å®¶ / åœ°åŒºæˆ–ç»„ç»‡ä½¿ç”¨çš„åç§°çš„ç±»å‹åç§°ï¼Œä¾‹å¦‚ .com
- **äºŒçº§åŸŸ**ï¼šä¸ªäººæˆ–ç»„ç»‡åœ¨å› ç‰¹ç½‘ä¸Šä½¿ç”¨çš„æ³¨å†Œåç§°ï¼Œä¾‹å¦‚ google.com
- **å­åŸŸ**ï¼šå·²æ³¨å†Œçš„äºŒçº§åŸŸåæ´¾ç”Ÿçš„åŸŸåï¼Œä¸€èˆ¬å°±æ˜¯ç½‘ç«™åï¼Œä¾‹å¦‚ www.google.com
- **ä¸»æœºå**ï¼šæ ‡è¯†ç½‘ç»œä¸Šçš„ç‰¹å®šè®¡ç®—æœºï¼Œä¾‹å¦‚ h1.www.google.com

## DNSçš„åŸºæœ¬è§£ææµç¨‹
1. ä»¥å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—® `www.lbinin.com` åŸŸåä¸ºä¾‹ï¼Œé¦–å…ˆï¼Œå®ƒä¼šå»æ£€æŸ¥å½“å‰æµè§ˆå™¨ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥å“åº”ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ç»§ç»­å¾€ä¸‹æ‰¾
2. æ¥ç€ï¼Œæ“ä½œç³»ç»Ÿä¼šå»æ£€æŸ¥è‡ªå·±çš„ host æ–‡ä»¶ï¼Œå¦‚æœä»ä¸­æ²¡æ‰¾åˆ°å¯¹åº”å…³ç³»ï¼Œä¼šå†åˆ°ç³»ç»Ÿ DNS ç¼“å­˜ä¸­æŸ¥ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰ï¼Œå°±ç›´æ¥è¿”å›è¯¥åŸŸåæ‰€å¯¹åº”çš„ IP
3. å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šå‘æˆ‘ä»¬äº‹å…ˆè®¾ç½®å¥½çš„ DNS æœåŠ¡å™¨ [ ä¸€èˆ¬æœ‰ä¸¤ä¸ªï¼Œ ä¸» & å¤‡ ] å»è¯·æ±‚ï¼Œå³æ‰€è°“çš„`é€’å½’æŸ¥è¯¢`ï¼ŒDNS æœåŠ¡å™¨é¦–å…ˆä¼šåˆ°è‡ªèº«è§£ææ•°æ®åº“ä¸­å»æŸ¥
4. å¦‚æœ DNS æœåŠ¡å™¨åœ¨è‡ªå·±çš„è§£æåº“ä¸­ä¹Ÿæ²¡æ‰¾åˆ°ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å‘æ ¹å‘é€è¯¢é—®è¯·æ±‚
5. æ­¤æ—¶ï¼Œæ ¹çœ‹åˆ°è¦è¯·æ±‚çš„æ˜¯ `com` çš„åç¼€ï¼Œå°±ä¼šæŠŠ `com` æ‰€åœ¨çš„ ns æœåŠ¡å™¨å‘Šè¯‰æˆ‘ä»¬çš„ DNS
6. ç„¶åï¼Œæˆ‘ä»¬çš„ DNS æœåŠ¡å™¨å°±ä¼šå»è¯·æ±‚ `com` æ‰€åœ¨çš„ ns æœåŠ¡å™¨ï¼ˆæƒå¨åŸŸåæœåŠ¡å™¨ï¼‰
7. å½“è¯·æ±‚åˆ°è¾¾ `com` ns æœåŠ¡å™¨æ—¶ï¼Œ`com` ä¸€çœ‹åŸŸåæ˜¯åœ¨ `lbinin` è¿™ä¸ªåŸŸä¸‹çš„ï¼Œå°±ä¼šæŠŠ `lbinin` æ‰€åœ¨çš„ ns æœåŠ¡å™¨å†å‘Šè¯‰æˆ‘ä»¬çš„ DNS æœåŠ¡å™¨
8. å†ç„¶åï¼Œæˆ‘ä»¬çš„ DNS æœåŠ¡å™¨å°±ä¼šå»è¯·æ±‚ `lbinin` è¿™ä¸ªåŸŸçš„ ns æœåŠ¡å™¨
9. `lbinin` è¿™ä¸ªåŸŸçš„ ns æœåŠ¡å™¨ä¸€çœ‹æ˜¯è¦è®¿é—® `www` å°±ç›´æ¥æ‰¾åˆ°äº† `www` å¯¹åº”çš„ã€ŒAè®°å½•ã€çš„ IPï¼Œå¹¶æŠŠå®ƒä¸¢ç»™æˆ‘ä»¬çš„ DNSï¼Œä¸Šé¢é€ä¸ªè¯¢é—®çš„è¿‡ç¨‹ï¼Œå³ `è¿­ä»£æŸ¥è¯¢`
10. æœ€åï¼Œæˆ‘ä»¬çš„ DNS å†æŠŠæœ€ç»ˆè§£æåˆ°çš„è¿™ä¸ª IP ä¸¢ç»™æˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å°±ç›´æ¥æ‹¿ç€å»è®¿é—®äº†ã€‚

### æµç¨‹æ€»ç»“

æµè§ˆå™¨ç¼“å­˜ ğŸ‘‰ğŸ» host æ–‡ä»¶ ğŸ‘‰ğŸ» ç³»ç»Ÿ DNS ç¼“å­˜ ğŸ‘‰ğŸ» DNS æœåŠ¡å™¨è¿›è¡Œã€Œè¿­ä»£æŸ¥è¯¢ã€

å…¶ä¸­ä¸Šé¢ 1-3 ä¸ºã€Œ[é€’å½’æŸ¥è¯¢](#é€’å½’æŸ¥è¯¢)ã€ã€‚4-10 ä¸ºã€Œ[è¿­ä»£æŸ¥è¯¢](#è¿­ä»£æŸ¥è¯¢)ã€ã€‚

## é€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢çš„åŒºåˆ«

### é€’å½’æŸ¥è¯¢

> å®¢æˆ·ç«¯æ”¶åˆ°çš„æ˜¯æœ€ç»ˆçš„æŸ¥è¯¢ç»“æœ

é€’å½’æŸ¥è¯¢æ˜¯ä¸€ç§ DNS æœåŠ¡å™¨çš„æŸ¥è¯¢æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ DNS æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·æœºè¯·æ±‚ï¼Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªå‡†ç¡®çš„æŸ¥è¯¢ç»“æœå›å¤å®¢æˆ·æœºã€‚å¦‚æœ DNS æœåŠ¡å™¨æœ¬åœ°æ²¡æœ‰å­˜å‚¨æŸ¥è¯¢DNS ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨ä¼šè¯¢é—®å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶å°†è¿”å›çš„**æŸ¥è¯¢ç»“æœ**æäº¤ç»™å®¢æˆ·æœºã€‚

### è¿­ä»£æŸ¥è¯¢

> å®¢æˆ·ç«¯ä¸­é€”ä¼šæ”¶åˆ°ä¸‹ä¸€å°æœåŠ¡å™¨åœ°å€

DNS æœåŠ¡å™¨å¦å¤–ä¸€ç§æŸ¥è¯¢æ–¹å¼ä¸ºè¿­ä»£æŸ¥è¯¢ï¼ŒDNS æœåŠ¡å™¨ä¼šå‘å®¢æˆ·æœºæä¾›å…¶ä»–èƒ½å¤Ÿè§£ææŸ¥è¯¢è¯·æ±‚çš„ DNS æœåŠ¡å™¨åœ°å€ï¼Œå½“å®¢æˆ·æœºå‘é€æŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒDNS æœåŠ¡å™¨å¹¶ä¸ç›´æ¥å›å¤æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯å‘Šè¯‰å®¢æˆ·æœºå¦ä¸€å° DNS **æœåŠ¡å™¨åœ°å€**ï¼Œå®¢æˆ·æœºå†å‘è¿™å° DNS æœåŠ¡å™¨æäº¤è¯·æ±‚ï¼Œä¾æ¬¡å¾ªç¯ç›´åˆ°è¿”å›æŸ¥è¯¢çš„ç»“æœä¸ºæ­¢ã€‚

## èµ„æºè®°å½•ç±»å‹

- **A è®°å½•**ï¼šFQDN -> ipv4

- **AAAA è®°å½•**ï¼šFQDN -> ipv6

- **NS è®°å½•**ï¼šåç§°æœåŠ¡å™¨ï¼›æ ‡æ˜å½“å‰åŒºåŸŸçš„ NS æœåŠ¡å™¨æ˜¯è°

- **MX è®°å½•**ï¼šé‚®ä»¶æœåŠ¡å™¨ï¼›æ ‡æ˜å½“å‰åŸŸå†…è°æ˜¯é‚®ä»¶æœåŠ¡å™¨

- **PTR è®°å½•**ï¼šIP -> FQDNï¼Œåå‘åŒºåŸŸè§£æ

- **SOA è®°å½•**ï¼šèµ·å§‹æˆæƒæœºæ„ï¼›ä¸€ä¸ªè§£æåº“æœ‰ä¸”åªæœ‰ä¸€ä¸ª SOA è®°å½•ï¼Œä¸”å¿…é¡»ä¸ºè§£æåº“çš„ç¬¬ä¸€æ¡è®°å½•

- **CNAME è®°å½•**ï¼šåˆ«åï¼Œå¦‚ï¼šweb.admin.org. IN CNAME www.admin.org. è¡¨ç¤ºå½“è®¿é—® web.admin.org. æ—¶å°±ç›´æ¥è§£æåˆ° www.admin.org.


## TTL

**Time to Live** å³ç”Ÿå­˜æ—¶é—´ï¼Œå°±æ˜¯ä¸€æ¡åŸŸåè§£æè®°å½•åœ¨ DNS æœåŠ¡å™¨ä¸­çš„å­˜ç•™æ—¶é—´ã€‚

å½“å„åœ°çš„ DNS æœåŠ¡å™¨æ¥å—åˆ°è§£æè¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘åŸŸåæŒ‡å®šçš„ NS æœåŠ¡å™¨ï¼ˆæƒå¨åŸŸåæœåŠ¡å™¨ï¼‰å‘å‡ºè§£æè¯·æ±‚ä»è€Œè·å¾—è§£æè®°å½•ï¼›

åœ¨è·å¾—è¿™ä¸ªè®°å½•ä¹‹åï¼Œè®°å½•ä¼šåœ¨ DNS æœåŠ¡å™¨ï¼ˆå„åœ°çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä¹Ÿå«é€’å½’åŸŸåæœåŠ¡å™¨ï¼‰ä¸­ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…å¦‚æœå†æ¥åˆ°è¿™ä¸ªåŸŸåçš„è§£æè¯·æ±‚ï¼ŒDNS æœåŠ¡å™¨å°†ä¸å†å‘ NS æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åˆšæ‰è·å¾—çš„è®°å½•ï¼›åˆ°æœŸåˆ™é‡å¤è¯·æ±‚è¿‡ç¨‹ã€‚

## DNS åŠ«æŒ

DNS åŠ«æŒåˆç§°ã€ŒåŸŸååŠ«æŒã€ï¼Œæ˜¯æŒ‡åœ¨åŠ«æŒçš„ç½‘ç»œèŒƒå›´å†…æ‹¦æˆªåŸŸåè§£æçš„è¯·æ±‚ï¼Œåˆ†æè¯·æ±‚çš„åŸŸåï¼ŒæŠŠå®¡æŸ¥èŒƒå›´ä»¥å¤–çš„è¯·æ±‚æ”¾è¡Œï¼Œå¦åˆ™è¿”å›å‡çš„ IP åœ°å€æˆ–è€…ä»€ä¹ˆéƒ½ä¸åšä½¿è¯·æ±‚å¤±å»å“åº”ï¼Œå…¶æ•ˆæœå°±æ˜¯å¯¹ç‰¹å®šçš„ç½‘ç»œä¸èƒ½è®¿é—®æˆ–è®¿é—®çš„æ˜¯å‡ç½‘å€ã€‚å…¶å®æœ¬è´¨å°±æ˜¯å¯¹ DNS è§£ææœåŠ¡å™¨åšæ‰‹è„šï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ä¼ªé€ çš„ DNS è§£ææœåŠ¡å™¨å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥å±•ç¤ºã€‚

### è§£å†³åŠæ³•

ä¸ä½¿ç”¨è¿è¥å•†çš„ NDS è§£æï¼Œä½¿ç”¨è‡ªå·±çš„æˆ–è€…è‘—åçš„ DNSï¼Œå¦‚ï¼š`114.114.114.114` å’Œ `8.8.8.8`

### å†…å®¹åŠ«æŒ

å…¶å®å†…å®¹åŠ«æŒä¸€å¼€å§‹çš„å‡ºå‘ç‚¹æ˜¯å¥½çš„ï¼Œæ˜¯è¿è¥å•†ä¸ºäº†åŠ å¿«ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦åŒæ—¶å‡å°‘è‡ªå·±çš„æµé‡æŸè€—è€Œåšçš„ä¸€ä¸ªç¼“å­˜æœºåˆ¶ã€‚

ç”¨æˆ·åœ¨åƒæœåŠ¡å™¨è¯·æ±‚æ•°æ®çš„æ—¶å€™è¿è¥å•†ä¼šæŠŠç”¨æˆ·çš„è¯·æ±‚è½¬ç§»åˆ°è¿™ä¸ªç¼“å­˜æ± ä¸­ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰å°±ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯å†å»å‘æœåŠ¡å™¨è¯·æ±‚ã€‚ç„¶åè¿è¥å•†æ‹¦æˆªå¹¶ç¼“å­˜æœåŠ¡ç«¯ç»™ç”¨æˆ·çš„å›è°ƒæ•°æ®ï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥æå¤§çš„é™ä½è¿è¥å•†åƒæœåŠ¡å™¨è¯·æ±‚çš„æ¬¡æ•°ï¼Œä¹Ÿèƒ½åŠ å¿«ç”¨æˆ·çš„è®¿é—®ï¼Œæ‰€ä»¥å‡ºå‘ç‚¹æ˜¯å¥½çš„ã€‚

ä½†æ˜¯ä¸€äº›éæ³•çš„å•†å®¶å¯¹ç¼“å­˜æ± å†…éƒ¨åšä¸€äº›å¤„ç†å°±æ˜¯ç›´æ¥å¯¹è¿”å›çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±ä¼šæ¥å—åˆ°é”™è¯¯çš„æ•°æ®ã€‚

## å¸¸ç”¨å‘½ä»¤
- `nslookup åŸŸå`

## å‚è€ƒèµ„æ–™
> [ç†è§£DNS - Code.CC - åšå®¢å›­](https://www.cnblogs.com/codecc/p/dns.html)
> 
> [DNS æ·±åº¦ç†è§£  ä¸€  - klionâ€™s blog](https://klionsec.github.io/2017/12/11/Dns-tips/)